<template>
  <form class="center form" @submit.prevent="register">
    <h3 class="form__title">Create account</h3>

<<<<<<< HEAD
    <div class="form__input_box">
      <label class="form__label"></label>
      <input
        placeholder="Email"
        v-model.trim="user.email"
        :class="{ form__input_hasError: v$.email.$invalid && v$.email.$dirty }"
        class="form__input_signUp"
        type="text"
        name="email"
      />
      <p
        class="form__error_message"
        v-for="err in v$.email.$errors"
        :key="err.$uid"
      >
        *{{ err.$message }}
      </p>
=======
        <div class="form__input_box">
            <label class="form__label">Name </label>
            <input v-model.trim="user.username"
                   :class="{ 'form__input_hasError': (v$.username.$invalid && v$.username.$dirty) }"
                   class="form__input"
                   type="text"
                   name="username" />
            <p class="form__error_message"
               v-for="err in v$.username.$errors"
               :key="err.$uid">
                *{{ err.$message }}
            </p>
        </div>

        <div class="form__input_box">
            <label class="form__label">Email </label>
            <input v-model.trim="user.email"
                   :class="{ 'form__input_hasError': (v$.email.$invalid && v$.email.$dirty) }"
                   class="form__input"
                   type="text"
                   name="email" />
            <p class="form__error_message"
               v-for="err in v$.email.$errors"
               :key="err.$uid">
                *{{ err.$message }}
            </p>
        </div>

        <div class="form__input_box">
            <label class="form__label">Password </label>
            <input v-model.trim="user.password"
                   :class="{ 'form__input_hasError': (v$.password.$invalid && v$.password.$dirty) }"
                   class="form__input"
                   type="password"
                   name="password" />
            <p class="form__error_message"
               v-for="err in v$.password.$errors"
               :key="err.$uid">
                *{{ err.$message }}
            </p>
        </div>

        <div class="form__input_box">
            <label class="form__label">Confirm password</label>
            <input v-model.trim="user.confirm_password"
                   :class="{ 'form__input_hasError': (v$.confirm_password.$invalid && v$.confirm_password.$dirty) }"
                   class="form__input"
                   type="password"
                   name="confirm_password" />
            <p class="form__error_message"
               v-for="err in v$.confirm_password.$errors"
               :key="err.$uid">
                *{{ err.$message }}
            </p>
        </div>

        <button type="submit" class="form__button">Submit</button>
    </form>

    <div>
        Already have an account? <router-link to="/">Sign in here</router-link>
>>>>>>> 8e827099d1b6aee7a9fe60b8dfba108dee7e3f82
    </div>

    <div class="form__input_box">
      <label class="form__label"></label>
      <input
        placeholder="Password"
        v-model.trim="user.password"
        :class="{
          form__input_hasError: v$.password.$invalid && v$.password.$dirty,
        }"
        class="form__input_signUp"
        type="password"
        name="password"
      />
      <p
        class="form__error_message"
        v-for="err in v$.password.$errors"
        :key="err.$uid"
      >
        *{{ err.$message }}
      </p>
    </div>

    <div class="form__input_box">
      <label class="form__label"></label>
      <input
        placeholder="Confirm password"
        v-model.trim="user.confirm_password"
        :class="{
          form__input_hasError:
            v$.confirm_password.$invalid && v$.confirm_password.$dirty,
        }"
        class="form__input_signUp"
        type="password"
        name="confirm_password"
      />
      <p
        class="form__error_message"
        v-for="err in v$.confirm_password.$errors"
        :key="err.$uid"
      >
        *{{ err.$message }}
      </p>
    </div>

    <button type="submit" class="form__button_submit">Submit</button>
  </form>

  <div class="center signUp__Wrap">
    Already have an account? <router-link to="/login">Log in here</router-link>
  </div>
</template>

<script>
import axios from "axios";
import { reactive, computed } from "vue";
import { email, required, sameAs, minLength } from "@vuelidate/validators";
import { useVuelidate } from "@vuelidate/core";

<<<<<<< HEAD
export default {
  setup() {
    const user = reactive({
      email: "",
      password: "",
      confirm_password: "",
    });

    const rules = computed(() => ({
      email: { required, email },
      password: { required, minLength: minLength(6) },
      confirm_password: { required, sameAs: sameAs(user.password) },
    }));
=======
    export default {
        setup() {
            const user = reactive({
                username:'',
                email: '',
                password: '',
                confirm_password: '',
            });

            const rules = computed(() => ({
                username: { required, minLength: minLength(2)  },
                email: { required, email },
                password: { required, minLength: minLength(6) },
                confirm_password: { required, sameAs: sameAs(user.password) },
            }));
>>>>>>> 8e827099d1b6aee7a9fe60b8dfba108dee7e3f82

    const v$ = useVuelidate(rules, user);

    const visible = reactive({ value: false });

<<<<<<< HEAD
    const resetForm = () => {
      user.email = "";
      user.password = "";
      user.confirm_password = "";
=======
            const resetForm = () => {
                user.username = '';
                user.email = '';
                user.password = '';
                user.confirm_password = '';
            };

            return {
                user, 
                v$,
                visible,
                resetForm,
            };
        },

        methods: {
            async register() {
                this.v$.$touch();
                if (!this.v$.$invalid) {
                    try {
                        await axios.post('api/register', {
                            email: this.user.email,
                            password: this.user.password,
                        });
                        this.$router.replace({ path: '/' });
                    } catch (error) {
                        console.error('Error:', error.response);
                    }
                    this.visible.value = true;
                    this.resetForm();
                    this.v$.$reset();
                }
            },
        }
>>>>>>> 8e827099d1b6aee7a9fe60b8dfba108dee7e3f82
    };

    return {
      user,
      v$,
      visible,
      resetForm,
    };
  },

  methods: {
    async register() {
      this.v$.$touch();
      if (!this.v$.$invalid) {
        try {
          await axios.post("api/register", {
            email: this.user.email,
            password: this.user.password,
          });
        } catch (error) {
          console.error("Error:", error.response);
        }
        this.visible.value = true;
        this.resetForm();
        this.v$.$reset();
      }
    },
  },
};
</script>
